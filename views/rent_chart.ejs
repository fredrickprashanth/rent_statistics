<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css" />
  <link rel="stylesheet" type="text/css" href="/stylesheets/foundation.css" />
  <script src="/javascripts/jquery.min.js"></script>
  <script src="/javascripts/foundation.min.js"></script>
  <script src="/javascripts/modernizr.js"></script>
  <script src="/javascripts/d3.min.js"></script>
  <script src="/javascripts/rickshaw.min.js"></script>
</head>

<body>
  <script>
      $(document).foundation();
  </script>

  <nav class="top-bar foundation-bar" data-topbar>
  <ul class="title-area">
    <li class="name">
      <h1><a href="#">Rental Statistics for various cities in Bay Area.</a></h1>
    </li>
  </ul>
  </nav>

  <div class="row">

  <div class="large-3 push-3 columns">
  <div id="rent_chart_render">
  </div>
  </div>

  <div class="large-5 pull-9 columns">
  <p class="panel">
  <% for (var i=0; i<cities.length; i++) { %>
  <a class="button round tiny" hcity="<%= cities[i] %>" id="city_btn"><%= cities[i] %></a> 
  <% } %>
  </p>
  </div>



  </div>


  <script>
  var url_parts = $(location).attr('href').split("/");
  var city = url_parts[url_parts.length-1];

  var graph = new Rickshaw.Graph({
            element: document.querySelector("#rent_chart_render"),
            renderer: 'bar',
            series: [{
                    data: [],
                    color: 'steelblue'
            }]
  });
  $.getJSON("/rent_chart_data/" + city, function(rent_data) {

    var rent_series = [];
    for (var i = 0; i<rent_data.length; i++) {
      var rent_vec = rent_data[i]
      rent_series.push({x:+i, y:+rent_vec[0]});
    }
    graph.series[0].data = rent_series;
    graph.render();

  });

  $('.button').click(function() {
    var city = $(this).attr("hcity");
    console.log(city);
    $.getJSON("/rent_chart_data/" + city, function(rent_data) {
      var rent_series = [];
      for (var i = 0; i<rent_data.length; i++) {
        var rent_vec = rent_data[i]
        rent_series.push({x:+i, y:+rent_vec[0]});
      }

      graph.series[0].data = rent_series;
      graph.render();
      graph.render();
    });
  });
  </script>

</body>
</html>
